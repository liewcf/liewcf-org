---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
---

<BaseLayout title="Contact | Liew CheonFong" description="Send a message to Liew CheonFong">
	<div class="stack gap-20">
		<main class="wrapper stack gap-8">
			<Hero title="Contact" tagline="Send a message and Iâ€™ll get back to you." align="start" />

			<form id="contact-form" class="contact-form">
				<div class="field">
					<label for="name">Name</label>
					<input id="name" name="name" type="text" autocomplete="name" required />
				</div>
				<div class="field">
					<label for="email">Email</label>
					<input id="email" name="email" type="email" autocomplete="email" required />
				</div>
				<div class="field">
					<label for="subject">Subject</label>
					<input id="subject" name="subject" type="text" required />
				</div>
				<div class="field">
					<label for="message">Message</label>
					<textarea id="message" name="message" rows="6" required></textarea>
				</div>

				<input class="honeypot" name="company" type="text" tabindex="-1" autocomplete="off" />

				<div class="turnstile">
					<div class="cf-turnstile" data-sitekey={import.meta.env.PUBLIC_TURNSTILE_SITE_KEY}></div>
				</div>

				<button type="submit" class="submit-button">Send Message</button>
				<p id="form-status" class="status" aria-live="polite"></p>
			</form>
		</main>
	</div>
</BaseLayout>

<script is:inline>
	const form = document.getElementById('contact-form');
	const status = document.getElementById('form-status');

	if (form) {
		form.addEventListener('submit', async (event) => {
			event.preventDefault();
			status.textContent = 'Sending...';

			const formData = new FormData(form);
			try {
				const response = await fetch('/api/contact', {
					method: 'POST',
					body: formData,
				});
				const result = await response.json().catch(() => ({}));

				if (response.ok) {
					status.textContent = 'Thanks! Your message has been sent.';
					form.reset();
					if (window.turnstile) {
						window.turnstile.reset();
					}
				} else {
					status.textContent = result?.error ?? 'Something went wrong. Please try again.';
				}
			} catch (error) {
				status.textContent = 'Unable to send right now. Please try again later.';
			}
		});
	}
</script>

<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer is:inline></script>

<style>
	.contact-form {
		display: grid;
		gap: 1.5rem;
		max-width: 40rem;
	}

	.field {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
		color: var(--gray-200);
	}

	label {
		font-family: var(--font-brand);
		color: var(--gray-0);
	}

	input,
	textarea {
		border-radius: 0.75rem;
		border: 1px solid var(--gray-800);
		background: var(--gray-999);
		padding: 0.75rem 1rem;
		color: var(--gray-0);
		font: inherit;
		box-shadow: var(--shadow-sm);
	}

	input:focus,
	textarea:focus {
		outline: 2px solid var(--accent-regular);
		outline-offset: 2px;
	}

	.honeypot {
		display: none;
	}

	.turnstile {
		display: flex;
		justify-content: flex-start;
	}

	.submit-button {
		align-self: flex-start;
		padding: 0.75rem 2.5rem;
		border: none;
		border-radius: 999rem;
		background: var(--gradient-accent-orange);
		color: var(--accent-text-over);
		font-family: var(--font-brand);
		font-size: var(--text-lg);
		box-shadow: var(--shadow-md);
		cursor: pointer;
	}

	.submit-button:hover {
		box-shadow: var(--shadow-lg);
	}

	.status {
		min-height: 1.5rem;
		color: var(--gray-300);
	}
</style>
